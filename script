local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Wins Hub",
    Icon = 0,
    LoadingTitle = "Loading...",
    LoadingSubtitle = "by win",
    ShowText = "Rayfield",
    Theme = "Default",
    ToggleUIKeybind = "K",
    ConfigurationSaving = { Enabled = true, FolderName = "niggerbitchpornhub,com", FileName = "winhub_config" },
})

local Tab = Window:CreateTab("Main")

-- Auto Collect toggle
_G.AutoCollect = false

local player = game.Players.LocalPlayer
local hrp

-- Re-acquire character and HRP if player respawns
local function getCharacter()
    local char = player.Character or player.CharacterAdded:Wait()
    hrp = char:WaitForChild("HumanoidRootPart")
end

getCharacter()
player.CharacterAdded:Connect(function()
    getCharacter()
end)

local itemPools = workspace:WaitForChild("ItemPools")
local normalGifts = itemPools:WaitForChild("NormalGifts")
local goldenGifts = itemPools:WaitForChild("GoldenGifts")
local beacon = workspace:WaitForChild("Beacon")

---------------------------------------------------------------------
-- FUNCTION: Get all gifts with Transparency == 0
---------------------------------------------------------------------
local function getAllGifts()
    local gifts = {}

    for _, gift in ipairs(normalGifts:GetChildren()) do
        if gift:IsA("BasePart") and gift.Transparency == 0 then
            gift.CanCollide = false
            table.insert(gifts, gift)
        end
    end

    for _, gold in ipairs(goldenGifts:GetChildren()) do
        if gold:IsA("BasePart") and gold.Transparency == 0 then
            gold.CanCollide = false
            table.insert(gifts, gold)
        end
    end

    return gifts
end

---------------------------------------------------------------------
-- FUNCTION: Find nearest part
---------------------------------------------------------------------
local function getNearest(pos, list)
    local nearest, dist = nil, math.huge
    for _, part in ipairs(list) do
        local d = (pos - part.Position).Magnitude
        if d < dist then
            nearest = part
            dist = d
        end
    end
    return nearest
end
local function F()
local VIM = game:GetService("VirtualInputManager")
VIM:SendKeyEvent(true, Enum.KeyCode.F, false, game)  -- key down
task.wait(0.1)
VIM:SendKeyEvent(false, Enum.KeyCode.F, false, game) -- key up
end
task.spawn(function()
    while true do
        task.wait(0.075)
        if not _G.AutoCollect then continue end
            local enemies = workspace.Enemies:GetChildren()

                    for i,v in ipairs(enemies) do
                v:Destroy()
           end
        -- Only run if there are no rooms
        local rooms = workspace:FindFirstChild("CurrentRooms")
        if not rooms or #rooms:GetChildren() == 0 then
            -- Ensure HRP exists
            if not hrp or not hrp.Parent then continue end

            local tpPos = CFrame.new(-0.371119589, 53.6797752, -8.38937)
            local offset = Vector3.new(3, 0, 0)

            -- Teleport once with offset
            hrp.CFrame = tpPos + offset

            -- Wait 0.5 seconds before calling F()
            task.wait(0.5)
            F()

            continue
        end

        -- Ensure HRP exists
        if not hrp or not hrp.Parent then continue end

        local gifts = getAllGifts()

        -- If gifts exist -> go collect them
        if #gifts > 0 then
            local nearest = getNearest(hrp.Position, gifts)  -- distance check is here
            if nearest then
                hrp.CFrame = CFrame.new(nearest.Position + Vector3.new(0, 3.3, 0))
            end
        else
            -------------------------------
            -- Beacon Teleport Delay
            -------------------------------

            task.wait(0.3)  -- wait longer before teleporting
            local recheck = getAllGifts()

            if #recheck == 0 then
                hrp.CFrame = CFrame.new(beacon.Position)
            end
        end
    end
end)

-- Periodic memory cleanup
task.spawn(function()
    while true do
        task.wait(60)  -- every 60 seconds
        collectgarbage()
    end
end)

Tab:CreateToggle({
    Name = "Auto Collect Gifts",
    CurrentValue = false,
    Flag = "AutoGift",
    Callback = function(Value)
        _G.AutoCollect = Value
    end,
})
