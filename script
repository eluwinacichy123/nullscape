local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Wins Hub",
    Icon = 0,
    LoadingTitle = "Loading...",
    LoadingSubtitle = "by win",
    ShowText = "Rayfield",
    Theme = "Default",
    ToggleUIKeybind = "K",
    ConfigurationSaving = { Enabled = true, FolderName = "niggerbitchpornhub,com", FileName = "winhub_config" },
})

local Tab = Window:CreateTab("Main")

-- Auto Collect toggle
_G.AutoCollect = false

local player = game.Players.LocalPlayer
local hrp

-- Re-acquire character and HRP if player respawns
local function getCharacter()
    local char = player.Character or player.CharacterAdded:Wait()
    hrp = char:WaitForChild("HumanoidRootPart")
end

getCharacter()
player.CharacterAdded:Connect(function()
    getCharacter()
end)

local itemPools = workspace:WaitForChild("ItemPools")
local normalGifts = itemPools:WaitForChild("NormalGifts")
local goldenGifts = itemPools:WaitForChild("GoldenGifts")
local beacon = workspace:WaitForChild("Beacon")

---------------------------------------------------------------------
-- FUNCTION: Get all gifts with Transparency == 0
---------------------------------------------------------------------
local function getAllGifts()
    local gifts = {}

    for _, gift in ipairs(normalGifts:GetChildren()) do
        if gift:IsA("BasePart") and gift.Transparency == 0 then
            gift.CanCollide = false
            table.insert(gifts, gift)
        end
    end

    for _, gold in ipairs(goldenGifts:GetChildren()) do
        if gold:IsA("BasePart") and gold.Transparency == 0 then
            gold.CanCollide = false
            table.insert(gifts, gold)
        end
    end

    return gifts
end

---------------------------------------------------------------------
-- FUNCTION: Find nearest part
---------------------------------------------------------------------
local function getNearest(pos, list)
    local nearest, dist = nil, math.huge
    for _, part in ipairs(list) do
        local d = (pos - part.Position).Magnitude
        if d < dist then
            nearest = part
            dist = d
        end
    end
    return nearest
end
local function F()
local VIM = game:GetService("VirtualInputManager")
VIM:SendKeyEvent(true, Enum.KeyCode.F, false, game)  -- key down
task.wait(0.1)
VIM:SendKeyEvent(false, Enum.KeyCode.F, false, game) -- key up
end
local DEBUG = true  -- set to false to mute logs


task.spawn(function()
    while true do
        task.wait(0.065)
        if not _G.AutoCollect then continue end

        local character = game.Players.LocalPlayer.Character
        local hrp = character and character:FindFirstChild("HumanoidRootPart")
        if not hrp then continue end

        local rooms = workspace:FindFirstChild("CurrentRooms")

        ----------------------------------------------------
        -- SELECTION SCREEN HANDLING
        ----------------------------------------------------
        if not rooms or #rooms:GetChildren() == 0 then
        local selectFolder = workspace.Select
local hrp = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

local enemychoice1 = {"Springer", "Bell", "Mart", "Skinwalker", "Dozer"}
local enemychoice2 = {"NIL", "Baby", "ICBM", "Flesh", "Voidbreaker", "Telefragger"}
local enemychoice3 = {"Guardian", "Voidbound Baby", "Voidbound Guardian", "???", "Kookoo", "Cadence"}

local cursechoice1 = {
    "IceTiles", "LowerGravity", "RandomSpawn", "WeakJumpPads", "BiggerTripmine",
    "Delusion", "HighRoller", "Tripmines", "MoreStairs", "Tripnuke",
    "TweakedOdds", "FakeCount", "FasterLevelDestroy", "CrayonEnemies", "Barotrauma",
    "UnderwaterMinefield", "BeaconMirage", "MartTransform", "BellTargetEnemy",
    "FasterSkinwalker", "SlowerSkinwalker", "SkinwalkerPresence", "TallSkinwalker",
    "TripleSkinwalker", "RandomSkinwalker", "Springloaded", "MightyChivalry",
    "Telestabber", "NilMirage", "BabyNoIndicator", "Shotgun", "Camouflage",
    "Malware", "TrapCard", "Run", "FragileTiles", "TelefragNoSound"
}

local cursechoice2 = {
    "Nothing", "Lap2", "SavoryRing", "ScatteredGifts", "MartSlide",
    "FleshHighReach", "NilChase", "ICBMBig", "TripleICBM", "ProblemChild",
    "BlueCheese", "OneLessChoice", "InverseDestruction", "VoidImplosions",
    "Sorrow", "Doombringer", "Tantrum", "Rebirth", "FleshNoDespawn",
    "VoidbreakerRapidFire", "VoidbreakerSlowFire"
}

local function inList(name, list)
    for _, v in ipairs(list) do
        if v == name then
            return true
        end
    end
    return false
end

local enemy1TP, enemy2TP, enemy3TP = nil, nil, nil
local curse1TP, curse2TP = nil, nil
local fallback3 = nil

for _, mango in ipairs(selectFolder:GetChildren()) do
    if mango.Name == "1" or mango.Name == "2" or mango.Name == "3" then
        local choiceName = mango:GetAttribute("ChoiceName")
        if not choiceName or choiceName == "" then continue end

        if inList(choiceName, enemychoice1) then
            enemy1TP = mango
        elseif inList(choiceName, enemychoice2) then
            enemy2TP = mango
        elseif inList(choiceName, enemychoice3) then
            enemy3TP = mango
        elseif inList(choiceName, cursechoice1) then
            curse1TP = mango
        elseif inList(choiceName, cursechoice2) then
            curse2TP = mango
        end

        -- Only assign fallback3 if this part is literally unused
        if mango.Name == "3" and not inList(choiceName, cursechoice1) and not inList(choiceName, cursechoice2)
            and not inList(choiceName, enemychoice1) and not inList(choiceName, enemychoice2) and not inList(choiceName, enemychoice3) then
            fallback3 = mango
        end
    end
end

local finalTeleport = enemy1TP or enemy2TP or enemy3TP or curse1TP or curse2TP or fallback3

if finalTeleport and hrp and hrp.Parent then
    hrp.CFrame = finalTeleport.CFrame
    if typeof(F) == "function" then F() end
end

            continue
        end

        ----------------------------------------------------
        -- GIFT COLLECTION HANDLING
        ----------------------------------------------------

        local gifts = getAllGifts()

        if #gifts > 0 then
            local nearest = getNearest(hrp.Position, gifts)
            if nearest then
                hrp.CFrame = CFrame.new(nearest.Position + Vector3.new(0, 3.3, 0))
            end

        else
            task.wait(0.3)

            local recheck = getAllGifts()
            if #recheck == 0 and beacon then
                hrp.CFrame = CFrame.new(beacon.Position)
            end
        end
    end
end)

----------------------------------------------------
-- MEMORY CLEANUP
----------------------------------------------------
task.spawn(function()
    while true do
        task.wait(60)
        collectgarbage()
    end
end)


Tab:CreateToggle({
    Name = "Auto Collect Gifts",
    CurrentValue = false,
    Flag = "AutoGift",
    Callback = function(Value)
        _G.AutoCollect = Value
    end,
})
